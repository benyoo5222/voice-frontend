{"ast":null,"code":"var _jsxFileName = \"/Users/benyoo/Desktop/voice-frontend/src/App.js\";\nimport React from 'react';\nimport logo from \"./logo.svg\";\nimport './App.css';\nimport crypto from 'crypto';\nimport v4 from './lib/aws-signature-v4';\nimport audioUtils from './lib/audioUtils';\nimport mic from 'microphone-stream'; // import marshaller from '@aws-sdk/eventstream-marshaller';\n// import util_utf8_node from '@aws-sdk/util-utf8-node';\n\nconst marshaller = require(\"@aws-sdk/eventstream-marshaller\"); // for converting binary event stream messages to and from JSON\n\n\nconst util_utf8_node = require(\"@aws-sdk/util-utf8-node\");\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\nconst context = new AudioContext();\nconst key = process.env.KEY;\nconst secret_key = process.env.SECRET_KEY;\nconst session_token = process.env.SESSION_TOKEN;\nconst region = process.env.REGION;\nconst language = process.env.LANGUAGE;\nconst sampleRate = process.env.SAMPLE_RATE;\nlet socket;\nlet micStream;\nlet inputSampleRate;\nconst eventStreamMarshaller = new marshaller.EventStreamMarshaller(util_utf8_node.toUtf8, util_utf8_node.fromUtf8); // const websocket = new WebSocket('ws://localhost:8000'); //put url\n// websocket.binaryType = \"arraybuffer\";\n// websocket.onopen = () => {\n//   console.log(\"Connected\");\n// };\n\nwebsocket.onerror = () => {\n  console.log(\"Error!!!!!!!!!\");\n};\n\nwebsocket.onmessage = message => {\n  console.log(\"MESSAGE\", message);\n};\n\nconst getAudioEventMessage = buffer => {\n  // wrap the audio data in a JSON envelope\n  return {\n    headers: {\n      ':message-type': {\n        type: 'string',\n        value: 'event'\n      },\n      ':event-type': {\n        type: 'string',\n        value: 'AudioEvent'\n      }\n    },\n    body: buffer\n  };\n};\n\nfunction convertAudioToBinaryMessage(audioChunk) {\n  let raw = mic.toRaw(audioChunk);\n  if (raw == null) return; // downsample and convert the raw audio bytes to PCM\n\n  let downsampledBuffer = audioUtils.downsampleBuffer(raw, inputSampleRate, sampleRate);\n  let pcmEncodedBuffer = audioUtils.pcmEncode(downsampledBuffer); // add the right JSON headers and structure to the message\n\n  let audioEventMessage = getAudioEventMessage(Buffer.from(pcmEncodedBuffer)); //convert the JSON object + headers into a binary event stream message\n\n  let binary = eventStreamMarshaller.marshall(audioEventMessage);\n  return binary;\n}\n\n;\n\nconst handleListen = () => {\n  navigator.mediaDevices.getUserMedia({\n    audio: true\n  }).then(stream => {\n    console.log(\"STREAm!!!\", stream);\n    micStream = new mic();\n    micStream.on(\"format\", function (data) {\n      inputSampleRate = data.sampleRate;\n    });\n    micStream.setStream(stream);\n    const websocket = new WebSocket('ws://localhost:8000'); //put url\n\n    websocket.binaryType = \"arraybuffer\";\n\n    websocket.onopen = () => {\n      console.log(\"Connected\");\n      micStream.on('data', function (rawAudioChunk) {\n        // the audio stream is raw audio bytes. Transcribe expects PCM with additional metadata, encoded as binary\n        console.log(\"DATA\", rawAudioChunk); //let binary = convertAudioToBinaryMessage(rawAudioChunk);\n\n        let binary = convertAudioToBinaryMessage(rawAudioChunk);\n        console.log(\"Binary\", binary);\n        websocket.send(binary); // if (socket.readyState === socket.OPEN)\n        //     socket.send(binary);\n      });\n    };\n  }).catch(err => {\n    console.log(\"error\", err);\n  });\n};\n\nfunction App() {\n  handleListen();\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"header\", {\n    className: \"App-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: logo,\n    className: \"App-logo\",\n    alt: \"logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }\n  }, \"Edit \", /*#__PURE__*/React.createElement(\"code\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 16\n    }\n  }, \"src/App.js\"), \" and save to reload.\"), /*#__PURE__*/React.createElement(\"a\", {\n    className: \"App-link\",\n    href: \"https://reactjs.org\",\n    target: \"_blank\",\n    rel: \"noopener noreferrer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  }, \"Learn React\")));\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/benyoo/Desktop/voice-frontend/src/App.js"],"names":["React","crypto","v4","audioUtils","mic","marshaller","require","util_utf8_node","AudioContext","window","webkitAudioContext","context","key","process","env","KEY","secret_key","SECRET_KEY","session_token","SESSION_TOKEN","region","REGION","language","LANGUAGE","sampleRate","SAMPLE_RATE","socket","micStream","inputSampleRate","eventStreamMarshaller","EventStreamMarshaller","toUtf8","fromUtf8","websocket","onerror","console","log","onmessage","message","getAudioEventMessage","buffer","headers","type","value","body","convertAudioToBinaryMessage","audioChunk","raw","toRaw","downsampledBuffer","downsampleBuffer","pcmEncodedBuffer","pcmEncode","audioEventMessage","Buffer","from","binary","marshall","handleListen","navigator","mediaDevices","getUserMedia","audio","then","stream","on","data","setStream","WebSocket","binaryType","onopen","rawAudioChunk","send","catch","err","App","logo"],"mappings":"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","sourcesContent":["import React from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport crypto from 'crypto';\nimport v4 from './lib/aws-signature-v4';\nimport audioUtils from './lib/audioUtils';\nimport mic from 'microphone-stream';\n\n// import marshaller from '@aws-sdk/eventstream-marshaller';\n// import util_utf8_node from '@aws-sdk/util-utf8-node';\n\nconst marshaller = require(\"@aws-sdk/eventstream-marshaller\"); // for converting binary event stream messages to and from JSON\nconst util_utf8_node = require(\"@aws-sdk/util-utf8-node\");\n\nconst AudioContext = window.AudioContext || window.webkitAudioContext;\nconst context = new AudioContext();\nconst key = process.env.KEY;\nconst secret_key = process.env.SECRET_KEY;\nconst session_token = process.env.SESSION_TOKEN;\nconst region = process.env.REGION;\nconst language = process.env.LANGUAGE;\nconst sampleRate = process.env.SAMPLE_RATE;\n\nlet socket;\nlet micStream;\nlet inputSampleRate;\n\nconst eventStreamMarshaller = new marshaller.EventStreamMarshaller(util_utf8_node.toUtf8, util_utf8_node.fromUtf8);\n\n// const websocket = new WebSocket('ws://localhost:8000'); //put url\n// websocket.binaryType = \"arraybuffer\";\n\n// websocket.onopen = () => {\n//   console.log(\"Connected\");\n// };\n\nwebsocket.onerror = () => {\n  console.log(\"Error!!!!!!!!!\")\n}\n\nwebsocket.onmessage = (message) => {\n  console.log(\"MESSAGE\", message);\n};\n\nconst getAudioEventMessage = (buffer) => {\n  // wrap the audio data in a JSON envelope\n  return {\n      headers: {\n          ':message-type': {\n              type: 'string',\n              value: 'event'\n          },\n          ':event-type': {\n              type: 'string',\n              value: 'AudioEvent'\n          }\n      },\n      body: buffer\n  };\n};\n\nfunction convertAudioToBinaryMessage(audioChunk) {\n  let raw = mic.toRaw(audioChunk);\n\n  if (raw == null)\n      return;\n\n  // downsample and convert the raw audio bytes to PCM\n  let downsampledBuffer = audioUtils.downsampleBuffer(raw, inputSampleRate, sampleRate);\n  let pcmEncodedBuffer = audioUtils.pcmEncode(downsampledBuffer);\n\n  // add the right JSON headers and structure to the message\n  let audioEventMessage = getAudioEventMessage(Buffer.from(pcmEncodedBuffer));\n\n  //convert the JSON object + headers into a binary event stream message\n  let binary = eventStreamMarshaller.marshall(audioEventMessage);\n\n  return binary;\n};\n\nconst handleListen = () => {\n  navigator.mediaDevices.getUserMedia({\n    audio: true,\n  }).then((stream) => {\n    console.log(\"STREAm!!!\", stream)\n    micStream = new mic();\n\n    micStream.on(\"format\", function(data) {\n        inputSampleRate = data.sampleRate;\n    });\n\n    micStream.setStream(stream);\n\n    const websocket = new WebSocket('ws://localhost:8000'); //put url\n    websocket.binaryType = \"arraybuffer\";\n\n    websocket.onopen = () => {\n      console.log(\"Connected\");\n      micStream.on('data', function(rawAudioChunk) {\n        // the audio stream is raw audio bytes. Transcribe expects PCM with additional metadata, encoded as binary\n        console.log(\"DATA\", rawAudioChunk);\n        //let binary = convertAudioToBinaryMessage(rawAudioChunk);\n        let binary = convertAudioToBinaryMessage(rawAudioChunk);\n        console.log(\"Binary\", binary);\n  \n        websocket.send(binary);\n        // if (socket.readyState === socket.OPEN)\n        //     socket.send(binary);\n      })    \n    };\n  })\n  .catch((err) => {\n    console.log(\"error\", err);\n  })\n};\n\nfunction App() {\n  handleListen();\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\n        <p>\n          Edit <code>src/App.js</code> and save to reload.\n        </p>\n        <a\n          className=\"App-link\"\n          href=\"https://reactjs.org\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n        >\n          Learn React\n        </a>\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}